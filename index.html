<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-Based-Game</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer">
    <script src="script.js"></script>
    <script src="assets.js"></script>
    <script src="encounter.js"></script>
    <script src="player.js"></script>
    <script src="inventory.js"></script>
    <script src="crafting.js"></script>
</head>

<body>
    <div id="global-tooltip"></div>
    <div alt="Background" id="background-image" class="background-image" x-init="startup()" x-data="{
            name: JSON.parse(localStorage.getItem('textBasedData'))?.name || '',
            location: 'Warhamshire',
            screen: JSON.parse(localStorage.getItem('textBasedData'))?.name ? 'returning' : 'new-player',
            showPlayerBar: false,
            enemy: getAssets().enemies.find(enemy => enemy.name == 'Fox King'),
            enemyLevel: 1,
            assets: getAssets()
        }" x-effect="showPlayerBar = !['new-player','how-to-play','journal', 'travel'].includes(screen)">

        <div id="overlay-transparency" class="overlay-transparency"></div>

        <div class="player" id="player" x-show="showPlayerBar" x-init="startPlayer()" x-data="{
                crit: 0,
                critdmg: 0,
                accuracy: 0,
                evasion: 0,
                defense: 60,
                experience: 0,
                health: 500,
                maxHealth: 500,
                stamina: 50,
                maxStamina: 50,
                weaponry: { weapon: getAssets().items.find(weapon => weapon.name == 'Hands'), level: 1 },
                armory: { armor: getAssets().items.find(armor => armor.name == 'None'), level: 1 },
                level: 1,
                attack: 32,
                pstatus: [],
                inventory: [],

                get experienceTooltip () {return `${Math.floor((this.experience/Math.floor(((this.level/0.07)**2)/2)) * 100)}% XP\nGained to grow stronger.`},
                get healthTooltip () {return `${Math.floor((this.health / this.maxHealth) * 100)}% Health\nUsed to keep you alive.`},
                get staminaTooltip () {return `${Math.floor((this.stamina / this.maxStamina) * 100)}% Stamina\nUsed to cast your weapon skills.\nYou gain ‚ö°${Math.round(this.maxStamina * 0.1)} per turn.`},
                tooltipMessages: [
                    `It's just you.`,
                    `Why hello, ${name}.`,
                    `Me!`,
                    `${name} is the best.`,
                    `${name} can't be changed later.`,
                    `${name}, meet ${name}.`,
                    `Who am I?`,
                    `Oh how the tables turn.`,
                    `Why am I doing this?`,
                    `Hi, I'm ${name}.`,
                    name,
                    `Thank you so much for playing.`,
                    `Are you lost?`,
                    `Are you an angel?`,
                    `Welcome to ${location}`,
                    `I bet you're afraid of the ${enemy.name}.`,
                    `Mwahahaha!`,
                    `Well well well, if it isn't ${name}.`,
                    `:|`,
                    `The ruler of them all.`,
                    `The destroyer.`,
                    `Are you inflicting 10% of base damage for 3 rounds? Because you are üî•.`,
                    `Are you negating all of my negative feelings? Because you are a blessing ‚ú®.`,
                    `Have any plans later today?`,
                    `Who else but you, right?`,
                    `Welcome to Text-Based-Game.`,
                    `My favorite person.`,
                    `I think you spelled this wrong, btw.`,
                    `Lil Timmy would be impressed.`,
                    `I remember you.`,
                    `Why not craft some capital letters?`,
                    `The sky falls without you.`,
                    `How many of these are there?`,
                    `You just keep coming back, huh?`,
                    `You're unstoppable!`,
                    `The chosen one.`,
                    `The hero we need.`,
                    `The hero we don't deserve.`,
                    `The legend.`,
                    `Villages fall and rise because of you.`,
                    `Songs are sung about you.`,
                    `Did you know you're my favorite player?`,
                    `They grow up so fast.`,
                    `Fighting all by yourself, handsome?`,
                    `Ooo.`,
                    `How do you even pronounce this??`,
                    `Is that your real name?`,
                    `I like your style.`,
                    `You're looking good today.`,
                    `Motivational statement.`,
                    `Borederline flirtatious statement.`,
                    `Sarcastic statement.`,
                    `Complimenting statement.`,
                    `Encouraging statement.`,
                    `Humorous statement.`,
                    `Inspirational statement.`,
                    `???`,
                    `ü´µ`,
                    `ü´∂`,
                    `üëã`,
                    `Back so soon?`,
                    `I can't believe you made it through these texts.`,
                    `Obligatory 'are you actually reading this' line.`,
                    `This isn't the stanley parable.`,
                    `Do you expect more to happen?`,
                    `I'm literally out of things to say!`,
                    `Stop.`,
                    `Stop it!`,
                    `Ha jk I don't really care.`,
                    `Oh but you're actually still going.`,
                    `Mk, that's ok. Fine. I can do this all day.`,
                    `.`,
                    `..`,
                    `...`,
                    `....`,
                    `.....`,
                    `......`,
                    `.......`,
                    `........`,
                    `.........`,
                    `..........`,
                    `Ok fine, this is taking up too many lines of code.`,
                    `Don't make me loop you.`,
                    `I will!`,
                    `Don't test me!`,
                    `Last chance.`,
                    `Last last chance!`,
                    `Alright, you've left me no choice.`,
                    `loop();`,
                ],
                tooltipText: 'You!',
                randomizeTooltip() {
                    this.tooltipIndex = ((this.tooltipIndex ?? -1) + 1) % this.tooltipMessages.length;
                    this.tooltipText = this.tooltipMessages[this.tooltipIndex];
                }
            }">
            <div class="player-hud">
                <p style="font-size: 60px; font-family: 'Pixelify Sans', sans-serif; margin-left: 20px; width: fit-content;"
                    @mouseenter="randomizeTooltip()" :data-tooltip="tooltipText" x-text="name"></p>

                <div class="experience-bar-background" :data-tooltip="experienceTooltip">
                </div>
                <div class="health-bar-background" :data-tooltip="healthTooltip"></div>
                <div class="stamina-bar-background" :data-tooltip="staminaTooltip">
                </div>

                <div class="experience-bar" id="experience" :data-tooltip="experienceTooltip">
                </div>
                <div class="health-bar" id="health" :data-tooltip="healthTooltip"></div>
                <div class="stamina-bar" id="stamina" :data-tooltip="staminaTooltip">
                </div>

                <div class="experience-bar-stats"
                    x-text="`Level ${level} - ${experience}/${Math.floor(((level/0.07)**2)/2)}`"
                    :data-tooltip="experienceTooltip">
                </div>
                <div class="health-bar-stats" x-text="`${health}/${maxHealth}`" :data-tooltip="healthTooltip">0/0</div>
                <div class="stamina-bar-stats" x-text="`${stamina}/${maxStamina}`" :data-tooltip="staminaTooltip">
                    0/0</div>

                <div class="mini-stats">
                    <img src="assets/effects/Luck.png"
                        style="width: 20px; height: 20px; display: inline-block; transform: translateY(4px);">
                    <span :data-tooltip="`Critical Chance\nThe chance your attack or heal will deal extra.`"
                        x-text="`${crit * 100}%`"></span>
                    <img src="assets/effects/Strength.png"
                        style="width: 20px; height: 20px; display: inline-block; transform: translateY(4px);">
                    <span :data-tooltip="`Critical Multiplier\nMultiplies your output on a successful crit.`"
                        x-text="`${critdmg}x`"></span>
                    <img src="assets/effects/Focus.png"
                        style="width: 20px; height: 20px; display: inline-block; transform: translateY(4px);">
                    <span :data-tooltip="`Accuracy\nThe chance to hit with an attack.`"
                        x-text="`${accuracy * 100}%`"></span>
                    <img src="assets/effects/Evasion.png"
                        style="width: 20px; height: 20px; display: inline-block; transform: translateY(4px);">
                    <span :data-tooltip="`Evasion\nDirectly decreases enemy accuracy.`"
                        x-text="`${evasion * 100}%`"></span>
                </div>
                <img :src="
                    health / maxHealth >= 0.8 ? 'assets/playerbar.png'
                    : health / maxHealth >= 0.6 ? 'assets/playerbarcracked1.png'
                    : health / maxHealth >= 0.4 ? 'assets/playerbarcracked2.png'
                    : health / maxHealth >= 0.2 ? 'assets/playerbarcracked3.png'
                    : health / maxHealth > 0 ? 'assets/playerbarcracked4.png'
                    : 'assets/playerbarcrackeddead.png'
                ">
            </div>
            <div class="pstatus-effects">
                <span x-show="pstatus.some(status => status.id == 'ü©∏')"
                    :data-tooltip="`ü©∏ ${pstatus.find(s => s.id == 'ü©∏').name} - ${pstatus.find(s => s.id == 'ü©∏').rounds} round${pstatus.find(s => s.id == 'ü©∏').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'ü©∏').description}\n\n${pstatus.find(s => s.id == 'ü©∏').damage} * ${pstatus.find(s => s.id == 'ü©∏').baseDam} = ${Math.floor(pstatus.find(s => s.id == 'ü©∏').damage * pstatus.find(s => s.id == 'ü©∏').baseDam)}`">ü©∏</span>
                <span x-show="pstatus.some(status => status.id == 'üëÅÔ∏è')"
                    :data-tooltip="`üëÅÔ∏è ${pstatus.find(s => s.id == 'üëÅÔ∏è').name} - ${pstatus.find(s => s.id == 'üëÅÔ∏è').rounds} round${pstatus.find(s => s.id == 'üëÅÔ∏è').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üëÅÔ∏è').description}`">üëÅÔ∏è</span>
                <span x-show="pstatus.some(status => status.id == 'üî•')"
                    :data-tooltip="`üî• ${pstatus.find(s => s.id == 'üî•').name} - ${pstatus.find(s => s.id == 'üî•').rounds} round${pstatus.find(s => s.id == 'üî•').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üî•').description}\n\n${pstatus.find(s => s.id == 'üî•').damage} * ${pstatus.find(s => s.id == 'üî•').baseDam} = ${Math.floor(pstatus.find(s => s.id == 'üî•').damage * pstatus.find(s => s.id == 'üî•').baseDam)}`">üî•</span>
                <span x-show="pstatus.some(status => status.id == 'üñ§')"
                    :data-tooltip="`üñ§ ${pstatus.find(s => s.id == 'üñ§').name} - ${pstatus.find(s => s.id == 'üñ§').rounds} round${pstatus.find(s => s.id == 'üñ§').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üñ§').description}\n\n${pstatus.find(s => s.id == 'üñ§').damage} * ${pstatus.find(s => s.id == 'üñ§').baseDam} = ${Math.floor(pstatus.find(s => s.id == 'üñ§').damage * pstatus.find(s => s.id == 'üñ§').baseDam)}`">üñ§</span>
                <span x-show="pstatus.some(status => status.id == 'üèÖ')"
                    :data-tooltip="`üèÖ ${pstatus.find(s => s.id == 'üèÖ').name} - ${pstatus.find(s => s.id == 'üèÖ').rounds} round${pstatus.find(s => s.id == 'üèÖ').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üèÖ').description}`">üèÖ</span>
                <span x-show="pstatus.some(status => status.id == 'üí®')"
                    :data-tooltip="`üí® ${pstatus.find(s => s.id == 'üí®').name} - ${pstatus.find(s => s.id == 'üí®').rounds} round${pstatus.find(s => s.id == 'üí®').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üí®').description}`">üí®</span>
                <span x-show="pstatus.some(status => status.id == 'üíÄ')"
                    :data-tooltip="`üíÄ ${pstatus.find(s => s.id == 'üíÄ').name} - ${pstatus.find(s => s.id == 'üíÄ').rounds} round${pstatus.find(s => s.id == 'üíÄ').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üíÄ').description}\n\n${maxHealth} * ${pstatus.find(s => s.id == 'üíÄ').maxHP} = ${Math.floor(maxHealth * pstatus.find(s => s.id == 'üíÄ').maxHP)}`">üíÄ</span>
                <span x-show="pstatus.some(status => status.id == 'üéØ')"
                    :data-tooltip="`üéØ ${pstatus.find(s => s.id == 'üéØ').name} - ${pstatus.find(s => s.id == 'üéØ').rounds} round${pstatus.find(s => s.id == 'üéØ').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üéØ').description}`">üéØ</span>
                <span x-show="pstatus.some(status => status.id == 'üõ°Ô∏è')"
                    :data-tooltip="`üõ°Ô∏è ${pstatus.find(s => s.id == 'üõ°Ô∏è').name} - ${pstatus.find(s => s.id == 'üõ°Ô∏è').rounds} round${pstatus.find(s => s.id == 'üõ°Ô∏è').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üõ°Ô∏è').description}`">üõ°Ô∏è</span>
                <span x-show="pstatus.some(status => status.id == 'ü©º')"
                    :data-tooltip="`ü©º ${pstatus.find(s => s.id == 'ü©º').name} - ${pstatus.find(s => s.id == 'ü©º').rounds} round${pstatus.find(s => s.id == 'ü©º').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'ü©º').description}`">ü©º</span>
                <span x-show="pstatus.some(status => status.id == 'üçÄ')"
                    :data-tooltip="`üçÄ ${pstatus.find(s => s.id == 'üçÄ').name} - ${pstatus.find(s => s.id == 'üçÄ').rounds} round${pstatus.find(s => s.id == 'üçÄ').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üçÄ').description}`">üçÄ</span>
                <span x-show="pstatus.some(status => status.id == 'üíó')"
                    :data-tooltip="`üíó ${pstatus.find(s => s.id == 'üíó').name} - ${pstatus.find(s => s.id == 'üíó').rounds} round${pstatus.find(s => s.id == 'üíó').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üíó').description}\n\n${maxHealth} * ${pstatus.find(s => s.id == 'üíó').maxHP} = ${Math.floor(pstatus.find(s => s.id == 'üíó').maxHP * maxHealth)}`">üíó</span>
                <span x-show="pstatus.some(status => status.id == 'üí™')"
                    :data-tooltip="`üí™ ${pstatus.find(s => s.id == 'üí™').name} - ${pstatus.find(s => s.id == 'üí™').rounds} round${pstatus.find(s => s.id == 'üí™').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üí™').description}`">üí™</span>
                <span x-show="pstatus.some(status => status.id == 'üåÄ')"
                    :data-tooltip="`üåÄ ${pstatus.find(s => s.id == 'üåÄ').name} - ${pstatus.find(s => s.id == 'üåÄ').rounds} round${pstatus.find(s => s.id == 'üåÄ').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üåÄ').description}`">üåÄ</span>
                <span x-show="pstatus.some(status => status.id == 'ü•Ä')"
                    :data-tooltip="`ü•Ä ${pstatus.find(s => s.id == 'ü•Ä').name} - ${pstatus.find(s => s.id == 'ü•Ä').rounds} round${pstatus.find(s => s.id == 'ü•Ä').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'ü•Ä').description}`">ü•Ä</span>
                <span x-show="pstatus.some(status => status.id == 'üí¢')"
                    :data-tooltip="`üí¢ ${pstatus.find(s => s.id == 'üí¢').name} - ${pstatus.find(s => s.id == 'üí¢').rounds} round${pstatus.find(s => s.id == 'üí¢').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üí¢').description}`">üí¢</span>
                <span x-show="pstatus.some(status => status.id == 'üí´')"
                    :data-tooltip="`üí´ ${pstatus.find(s => s.id == 'üí´').name} - ${pstatus.find(s => s.id == 'üí´').rounds} round${pstatus.find(s => s.id == 'üí´').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üí´').description}`">üí´</span>
                <span x-show="pstatus.some(status => status.id == '‚ú®')"
                    :data-tooltip="`‚ú® ${pstatus.find(s => s.id == '‚ú®').name} - ${pstatus.find(s => s.id == '‚ú®').rounds} round${pstatus.find(s => s.id == '‚ú®').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == '‚ú®').description}`">‚ú®</span>
                <span x-show="pstatus.some(status => status.id == 'üåë')"
                    :data-tooltip="`üåë ${pstatus.find(s => s.id == 'üåë').name} - ${pstatus.find(s => s.id == 'üåë').rounds} round${pstatus.find(s => s.id == 'üåë').rounds > 1 ? 's' : ''} remaining\n\n${pstatus.find(s => s.id == 'üåë').description}`">üåë</span>
                <span x-show="health <= 0" data-tooltip="You are dead.">‚ò†Ô∏è</span>
            </div>
            <div class="battle-weaponry" id="battle-weaponry" style="display: block; text-align: center;">
                <span
                    :data-tooltip="`Base Attack\n\n32 + ((${level || 1} - 1) * 6) + ${weaponry.weapon.attack} + ((${weaponry.level} - 1) * ${weaponry.weapon.attackPerLevel}) = ${Math.floor(32 + (((level || 1) - 1) * 6) + weaponry.weapon.attack + ((weaponry.level - 1) * weaponry.weapon.attackPerLevel))}`"
                    x-text="`‚öîÔ∏è${attack}`"></span>
                <span
                    :data-tooltip="`Base Defense\n\n60 + ((${level || 1} - 1) * 10) + ${armory.armor.defense} + ((${armory.level} - 1) * ${armory.armor.alvlmult}) = ${Math.floor(60 + (((level || 1) - 1) * 10) + armory.armor.defense + ((armory.level - 1) * armory.armor.alvlmult))}`"
                    x-text="`üõ°Ô∏è${defense}`"></span>
                <br><br>
                <span draggable="true"
                    :style="armory.armor ?.synergies.some(syn => syn.weapon == weaponry.weapon.name) ?? false ? `text-decoration: underline; cursor: grab;` : `cursor: grab;`"
                    :data-tooltip="`${weaponry.weapon.description}\n‚öîÔ∏è${Math.floor(weaponry.weapon.attack + ((weaponry.level - 1) * weaponry.weapon.attackPerLevel))} üçÄ${Math.floor(weaponry.weapon.crit * 100)}% ‚öîÔ∏è${weaponry.weapon.critdmg}x üéØ${Math.floor(weaponry.weapon.accuracy * 100)}%`"
                    x-text="`${weaponry.weapon.name} - ${weaponry.level}`"></span>
                <br><br>
                <span draggable="true"
                    :style="armory.armor ?.synergies.some(syn => syn.weapon == weaponry.weapon.name) ?? false ? `text-decoration: underline; cursor: grab;` : `cursor: grab;`"
                    :data-tooltip="`${armory.armor.description}\nüõ°Ô∏è${Math.floor(armory.armor.defense + ((armory.level - 1) * armory.armor.alvlmult))} üí®${Math.floor(armory.armor.evasion * 100)}%`"
                    x-text="`${armory.armor.name} - ${armory.level}`"></span>
            </div>
        </div>

        <div id="screen" class="screen">
            <!-- New Player (Title Screen)-->
            <div id="new-player" class="new-player" x-show="screen === 'new-player'">
                <button class="regular-button"
                    style="background-color: rgb(20, 5, 228); color: white; border: 5px solid rgb(1, 0, 88); font-size: large;"
                    @click="importButton()">IMPORT</button>
                <p style="text-align: center; font-size: 30px; top: 25px;">Welcome to</p>
                <h1 style="text-align: center; font-size: 60px; top: 50px; font-weight: bold;">Text - Based - Game</h1>
                <div class="centered-inputs">
                    <h1 style="text-align: center; font-size: 60px; font-family: 'Pixelify Sans', sans-serif;"
                        x-text="`${name ? `Why hello, ${name}!` : 'What is your name, Traveler?'}`">What is your
                        name, Traveler?</h1>
                    <input class="name-input" type="text" id="name" name="name" required minlength="1" maxlength="16"
                        size="100" placeholder="I'm..." x-model="name" autocomplete="off"
                        @keyup.enter="if (name) { startGame(name); updateBars() }" />
                    <button class="regular-button" @click="startGame(name); updateBars()" x-show="name"
                        style="color: white;">Onwards</button>
                </div>
                <div class="credits">
                    <span style="color: grey;">Made by Jgouken &amp; SavorySam</span>
                    <span>Your gameplay is saved through cache and
                        cookies. If you clear or block either on this website, <u>you will lose your data.</u></span>
                    <span style="color: grey;">Art by MoBroPro</span>
                </div>
            </div>

            <!-- Returning Player (Landing Screen)-->
            <div id="returning" class="returning" x-show="screen === 'returning'" style="display: none;">
                <p style="text-align: center; font-size: 30px; top: 25px;">Text-Based-Game</p>
                <p style="text-align: center; font-size: 60px; font-family: 'Pixelify Sans', sans-serif; top: 280px;"
                    x-text="location.toUpperCase()"></p>

                <div class="centered-buttons"
                    style="justify-content: right; margin-top: 0; margin-right: 10px; position: fixed; top: 10px; right: 10px; z-index: 1000;">
                    <button class="regular-button"
                        style="background-color: rgb(20, 5, 228); color: white; border: 5px solid rgb(1, 0, 88); justify-content: right; font-size: large;"
                        @click="transition('returning', 'how-to-play')">How To Play</button>
                </div>

                <div class="centered-buttons"
                    style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000; gap: 20px; width: 100%; justify-content: flex-start; padding: 10px; margin-top: 0px;">
                    <button class="regular-button"
                        style="background-color: red; color: white; border: 5px solid rgb(88, 0, 0); font-size: large;"
                        @click="deleteButton()">DELETE</button>
                    <button class="regular-button"
                        style="background-color: rgb(42, 201, 42); border: 5px solid rgb(0, 88, 0); font-size: large;"
                        @click="exportButton()">EXPORT</button>
                    <button class="regular-button"
                        style="background-color: rgb(20, 5, 228); color: white; border: 5px solid rgb(1, 0, 88); font-size: large;"
                        @click="importButton()">IMPORT</button>
                </div>

                <div class="centered-buttons" style="margin-top: 350px;">
                    <button class="regular-button"
                        style="background-color: rgb(20, 5, 228); color: white; border: 5px solid rgb(1, 0, 88);"
                        @click="transition('returning', 'travel')">Travel</button>
                    <button class=" regular-button"
                        style="background-color: rgb(42, 201, 42); border: 5px solid rgb(0, 88, 0);"
                        @click="transition('returning', 'encounter'); startBattle()">Encounter</button>
                    <button class="regular-button"
                        style="background-color: red; color: white; border: 5px solid rgb(88, 0, 0);"
                        @click="quitButton()">Quit</button>
                </div>

                <div class="centered-buttons" style="margin-top: 20px;">
                    <button class="regular-button"
                        style="background-color: rgb(92, 80, 255); color: black; border: 5px solid rgb(6, 4, 122);"
                        @click="transition('returning', 'inventory')">Inventory</button>
                    <button class="regular-button"
                        style="background-color: rgb(184, 111, 218); border: 5px solid rgb(153, 9, 219);"
                        @click="transition('returning', 'journal')">Journal</button>
                    <button class="regular-button"
                        style="background-color: rgb(184, 255, 150); color: black; border: 5px solid rgb(15, 160, 1);"
                        @click="transition('returning', 'crafting')">Crafting</button>
                </div>

                <div class="credits">
                    <span style="color: grey;">Made by Jgouken &amp; SavorySam</span>
                    <span>Your gameplay is saved through cache and
                        cookies. If you clear or block either on this website, <u>you will lose your data.</u></span>
                    <span style="color: grey;">Art by MoBroPro</span>
                </div>
            </div>

            <!-- How To Play -->
            <div id="how-to-play" class="how-to-play" x-show="screen === 'how-to-play'">

            </div>

            <!-- Inventory -->
            <div id="inventory" class="inventory" x-show="screen === 'inventory'" x-data="{ 
                    activeTab: 'all', 
                    sortBy: 'name', 
                    sortOrder: 'asc', 
                    searchQuery: '',
                    getTooltipText(itemName) {
                        const it = assets.items.find(i => i.name === itemName);
                        if (!it) return '';
                        return Object.keys(it).length === 1 ? 'Crafting Reagent' : (it.description || '');
                    }
                }"
                x-effect="$watch('sortBy', () => refreshSynergies()); $watch('sortOrder', () => refreshSynergies())">
                <div class="inventory-panel" id="inventory-panel">
                    <!-- Folder-style tabs -->
                    <div class="inventory-tabs">
                        <button class="regular-button"
                            style="background-color: rgb(20, 5, 228); color: white; border: 5px solid rgb(1, 0, 88); font-size: large;"
                            @click="transition('inventory', 'returning')">Back</button>
                        <button @click="activeTab = 'all'" class="inventory-tab"
                            :class="{ 'inventory-tab--active': activeTab === 'all' }">
                            All
                        </button>
                        <button @click="activeTab = 'equipment'" class="inventory-tab"
                            :class="{ 'inventory-tab--active': activeTab === 'equipment' }">
                            Equipment
                        </button>
                        <button @click="activeTab = 'consumables'" class="inventory-tab"
                            :class="{ 'inventory-tab--active': activeTab === 'consumables' }">
                            Consumables
                        </button>
                        <button @click="activeTab = 'battleReady'" class="inventory-tab"
                            :class="{ 'inventory-tab--active': activeTab === 'battleReady' }">
                            Throwables
                        </button>
                        <button @click="activeTab = 'keys'" class="inventory-tab"
                            :class="{ 'inventory-tab--active': activeTab === 'keys' }">
                            Keys
                        </button>
                        <button @click="activeTab = 'miscellaneous'" class="inventory-tab"
                            :class="{ 'inventory-tab--active': activeTab === 'miscellaneous' }">
                            Misc
                        </button>
                    </div>

                    <!-- Sort options -->
                    <div
                        style="padding: 10px; display: flex; gap: 10px; align-items: center; background-color: rgba(0,0,0,0.3);">
                        <span style="color: white; font-size: 14px;">Sort by:</span>
                        <button @click="sortBy = 'name'; refreshSynergies()" class="inventory-tab"
                            :class="{ 'inventory-tab--active': sortBy === 'name' }"
                            style="padding: 5px 10px; font-size: 12px;">
                            Name
                        </button>
                        <button @click="sortBy = 'type'; refreshSynergies()" class="inventory-tab"
                            :class="{ 'inventory-tab--active': sortBy === 'type' }"
                            style="padding: 5px 10px; font-size: 12px;">
                            Type
                        </button>
                        <button @click="sortBy = 'level'; refreshSynergies()" class="inventory-tab"
                            :class="{ 'inventory-tab--active': sortBy === 'level' }"
                            style="padding: 5px 10px; font-size: 12px;">
                            Level
                        </button>
                        <button @click="sortOrder = sortOrder === 'asc' ? 'desc' : 'asc'; refreshSynergies()"
                            class="inventory-tab" style="padding: 5px 10px; font-size: 12px;"
                            data-tooltip="Click to reverse">
                            <span x-text="sortOrder === 'asc' ? '‚Üë Ascending' : '‚Üì Descending'"></span>
                        </button>
                    </div>

                    <div
                        style="padding: 10px; display: flex; gap: 10px; align-items: center; background-color: rgba(0,0,0,0.25); border-top: 1px solid rgba(255,255,255,0.1);">
                        <span style="color: white; font-size: 14px;">Search:</span>
                        <input x-model="searchQuery" type="text" placeholder="Search inventory..."
                            style="font-family: 'Pixelify Sans', sans-serif; font-size: 14px; padding: 6px 10px; min-width: 260px; background-color: rgba(0,0,0,0.5); border: 2px solid #333; color: white;" />
                        <button class="inventory-tab" style="padding: 5px 10px; font-size: 12px;" x-show="searchQuery"
                            @click="searchQuery = ''">Clear</button>
                    </div>

                    <div class="inventory-grid">
                        <template x-for="(item, idx) in (() => {
                let inventory = Alpine.$data(document.getElementById('player')).inventory;
                
                // Filter items
                let filtered = inventory.filter((item, idx) => {
                    let it = assets.items.find(i => i.name === item.name);
                    if (!it) return false;
                    
                    if (activeTab === 'all') return true;
                    
                    const isEquipment = (it.attack !== undefined && it.skills) || (it.defense !== undefined && !it.skills && it.alvlmult !== undefined);
                    const isConsumable = it.name.toLowerCase().includes('potion');
                    const isBattleReady = it.name.toLowerCase().endsWith('bomb') || it.name.toLowerCase().endsWith('flask');
                    const isKey = it.chest !== undefined;
                    const isMiscellaneous = !isEquipment && !isConsumable && !isBattleReady && !isKey;
                    
                    if (activeTab === 'equipment') return isEquipment;
                    if (activeTab === 'consumables') return isConsumable;
                    if (activeTab === 'battleReady') return isBattleReady;
                    if (activeTab === 'keys') return isKey;
                    if (activeTab === 'miscellaneous') return isMiscellaneous;
                    
                    return false;
                });

                const query = searchQuery.toLowerCase().trim();
                if (query) {
                    filtered = filtered.filter(item => {
                        const it = assets.items.find(i => i.name === item.name);
                        const nameMatch = item.name.toLowerCase().includes(query);
                        const descMatch = (it?.description || '').toLowerCase().includes(query);
                        return nameMatch || descMatch;
                    });
                }
                
                filtered.sort((a, b) => {
                    let aItem = assets.items.find(i => i.name === a.name);
                    let bItem = assets.items.find(i => i.name === b.name);
                    
                    let compareVal = 0;
                    
                    if (sortBy === 'name') {
                        compareVal = a.name.localeCompare(b.name);
                    } else if (sortBy === 'type') {
                        // Weapons, Armor, Throwables, Consumables, Misc, Keys
                        const getTypeOrder = (item) => {
                            if (item.attack !== undefined && item.skills) return 0; // weapon
                            if (item.defense !== undefined && !item.skills && item.alvlmult !== undefined) return 1; // armor
                            if (item.damage || item.estatus || (item.buff && item.rounds)) return 2; // throwables
                            if (item.health || item.stamina || item.xp || item.pstatus) return 3; // consumable
                            if (item.chest !== undefined) return 5; // keys
                            return 4; // misc
                        };
                        
                        const aType = getTypeOrder(aItem);
                        const bType = getTypeOrder(bItem);
                        
                        compareVal = aType - bType;
                        if (compareVal === 0) {
                            compareVal = a.name.localeCompare(b.name);
                        }
                    } else if (sortBy === 'level') {
                        const aLevel = a.level ?? 1;
                        const bLevel = b.level ?? 1;
                        compareVal = aLevel - bLevel;
                        if (compareVal === 0) {
                            compareVal = a.name.localeCompare(b.name);
                        }
                    }
                    
                    return sortOrder === 'asc' ? compareVal : -compareVal;
                });
                
                return filtered;
            })()" :key="idx">
                            <div class="inventory-item" :class="{'inventory-item--no-icon': !(item.sprite)}"
                                :data-tooltip="getTooltipText(item.name)" draggable="true" x-data="{
                    get desc() {
                        let it = assets.items.find(i => i.name === item.name);
                        const parts = [];
                        if (it.attack !== undefined || it.defense !== undefined || it.maxlvl) {
                            parts.push('Level ' + (item.level ?? 1));
                            if (it.attack !== undefined) {
                                parts.push(`‚öîÔ∏è${Math.floor(it.attack + ((item.level ?? 1 - 1) * it.attackPerLevel))} üçÄ${Math.floor(it.crit * 100)}% ‚öîÔ∏è${it.critdmg}x üéØ${Math.floor(it.accuracy * 100)}%`);
                            } else if (it.defense !== undefined) {
                                parts.push(`üõ°Ô∏è${Math.floor(it.defense + ((item.level ?? 1 - 1) * it.alvlmult))} üí®${Math.floor(it.evasion * 100)}%`);
                            }
                        }
                        if (it.health) parts.push(`üíñ +${Math.round(it.health * 100)}%`);
                        if (it.def) parts.push(`üõ°Ô∏è +${Math.round(it.def * 100)}% ${it.rounds ? `for ${it.rounds} turns` : 'for 1 turn'}`);
                        if (it.stamina) parts.push(`‚ö° +${Math.round(it.stamina * 100)}%`);
                        if (it.buff) parts.push('‚öîÔ∏è +' + Math.round(it.buff * 100) + '% ' + `for ${it.rounds ? it.rounds + ' turns' : '1 turn'}`);
                        if (it.xp) parts.push(`üåü ${it.xp} XP`);
                        if (it.chest !== undefined) parts.push(`Opens ${assets.chests[it.chest].name}`);
                        if (it.damage) parts.push(`üí• ${it.damage}`);
                        if (it.pstatus) parts.push(`Gain ${it.pstatus.join(', ')}`);
                        if (it.estatus) parts.push(`Inflicts ${it.estatus.join(', ')}`);
                        if (parts.length) return parts.join('\n');
                        else return 'Crafting Reagent';
                    }
                }">
                                <div class="inventory-item-amount inventory-item-amount--inline"
                                    x-show="item.amount > 1 && !(item.sprite)">x<span x-text="item.amount"></span>
                                </div>
                                <div class="inventory-item-icon-wrap"
                                    x-show="(() => { let it = assets.items.find(i => i.name === item.name); return it && it.chest !== undefined; })()">
                                    <img class="inventory-item-icon"
                                        :src="`assets/keys/${item.name.replace(/ /g, '')}.gif`" alt="" />
                                </div>
                                <div class="inventory-item-body">
                                    <div style="display:flex; align-items:center; gap:8px;">
                                        <div class="inventory-item-name" x-text="item.name">Item</div>
                                    </div>
                                    <div class="inventory-item-meta" x-text="desc"></div>
                                </div>
                            </div>
                        </template>

                        <div class="inventory-empty" x-show="(() => {
                const inventory = Alpine.$data(document.getElementById('player')).inventory;
                if (inventory.length === 0) return true;
                
                const filteredItems = inventory.filter(item => {
                    let it = assets.items.find(i => i.name === item.name);
                    if (!it) return false;
                    
                    if (activeTab === 'all') return true;
                    
                    const isEquipment = (it.attack !== undefined && it.skills) || (it.defense !== undefined && !it.skills && it.alvlmult !== undefined);
                    const isConsumable = it.name.toLowerCase().includes('potion');
                    const isBattleReady = it.name.toLowerCase().endsWith('bomb') || it.name.toLowerCase().endsWith('flask');
                    const isKey = it.chest !== undefined;
                    const isMiscellaneous = !isEquipment && !isConsumable && !isBattleReady && !isKey;
                    
                    if (activeTab === 'equipment') return isEquipment;
                    if (activeTab === 'consumables') return isConsumable;
                    if (activeTab === 'battleReady') return isBattleReady;
                    if (activeTab === 'keys') return isKey;
                    if (activeTab === 'miscellaneous') return isMiscellaneous;
                    
                    return false;
                });

                const query = searchQuery.toLowerCase().trim();
                const searchedItems = query
                    ? filteredItems.filter(item => {
                        let it = assets.items.find(i => i.name === item.name);
                        const nameMatch = item.name.toLowerCase().includes(query);
                        const descMatch = (it?.description || '').toLowerCase().includes(query);
                        return nameMatch || descMatch;
                    })
                    : filteredItems;
                
                return searchedItems.length === 0;
            })()">
                            No items in this category
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Journal -->
        <div id="journal" class="journal" x-show="screen === 'journal'">

        </div>

        <!-- Crafting-->
        <div id="crafting" class="crafting" x-show="screen === 'crafting'" x-data="{
                activeTab: 'all',
                sortBy: 'name',
                sortOrder: 'asc',
                searchQuery: '',
                hoveredCraftItem: null,
                craftSearch: '',
                craftingInventorySearch: '',
                get craftables() {
                    const query = this.craftSearch.toLowerCase().trim();
                    return assets.items.filter(item => {
                        if (!item.craft) return false;
                        const hasAnyIngredient = item.craft.some(ingredient => this.getOwnedAmount(ingredient) > 0);
                        if (!query) return hasAnyIngredient;
                        return item.name.toLowerCase().includes(query) || (item.description || '').toLowerCase().includes(query);
                    });
                },
                get playerInventory() {
                    return Alpine.$data(document.getElementById('player')).inventory;
                },
                get shownCraftingInventory() {
                    const query = this.craftingInventorySearch.toLowerCase().trim();
                    if (!query) return this.playerInventory;
                    return this.playerInventory.filter(item => {
                        const it = assets.items.find(i => i.name === item.name);
                        return item.name.toLowerCase().includes(query) || (it?.description || '').toLowerCase().includes(query);
                    });
                },
                getOwnedAmount(itemName) {
                    return this.playerInventory
                        .filter(item => item.name === itemName)
                        .reduce((total, item) => total + (item.amount || 1), 0);
                },
                getIngredientCount(craftList, itemName) {
                    return craftList.filter(name => name === itemName).length;
                },
                getTooltipText(itemName) {
                    const it = assets.items.find(i => i.name === itemName);
                    if (!it) return '';
                    return Object.keys(it).length === 1 ? 'Crafting Reagent' : (it.description || '');
                },
                getCraftableTooltipText(item) {
                    const text = (item?.description || '').trim();
                    return text || null;
                },
                getInventoryStyleDescription(item, level = 1) {
                    if (!item) return '';
                    const parts = [];

                    if (item.attack !== undefined || item.defense !== undefined || item.maxlvl) {
                        parts.push('Level ' + (level ?? 1));
                        if (item.attack !== undefined) {
                            parts.push(`‚öîÔ∏è${Math.floor(item.attack + (((level ?? 1) - 1) * item.attackPerLevel))} üçÄ${Math.floor(item.crit * 100)}% ‚öîÔ∏è${item.critdmg}x üéØ${Math.floor(item.accuracy * 100)}%`);
                        } else if (item.defense !== undefined) {
                            parts.push(`üõ°Ô∏è${Math.floor(item.defense + (((level ?? 1) - 1) * item.alvlmult))} üí®${Math.floor(item.evasion * 100)}%`);
                        }
                    }

                    if (item.health) parts.push(`üíñ +${Math.round(item.health * 100)}%`);
                    if (item.def) parts.push(`üõ°Ô∏è +${Math.round(item.def * 100)}% ${item.rounds ? `for ${item.rounds} turns` : 'for 1 turn'}`);
                    if (item.stamina) parts.push(`‚ö° +${Math.round(item.stamina * 100)}%`);
                    if (item.buff) parts.push('‚öîÔ∏è +' + Math.round(item.buff * 100) + '% ' + `${item.rounds ? item.rounds + ' turns' : '1 turn'}`);
                    if (item.xp) parts.push(`üåü ${item.xp} XP`);
                    if (item.chest !== undefined) parts.push(`Opens ${assets.chests[item.chest].name}`);
                    if (item.damage) parts.push(`üí• ${item.damage}`);
                    if (item.pstatus) parts.push(`Gain ${item.pstatus.join(', ')}`);
                    if (item.estatus) parts.push(`Inflicts ${item.estatus.join(', ')}`);

                    return parts.length ? parts.join('\n') : 'Crafting Reagent';
                },
                getCraftableDescription(item) {
                    const text = this.getInventoryStyleDescription(item);
                    if (!text || text === 'Crafting Reagent') return null;
                    return text;
                },
                canCraft(item) {
                    if (!item || !item.craft) return false;
                    return item.craft.every(ingredient => this.getOwnedAmount(ingredient) >= this.getIngredientCount(item.craft, ingredient));
                },
                inventoryItemInHoveredRecipe(inventoryItem) {
                    if (!this.hoveredCraftItem || !this.hoveredCraftItem.craft) return false;
                    return this.getIngredientCount(this.hoveredCraftItem.craft, inventoryItem.name) > 0;
                }
            }">
            <div class="crafting-panel" id="crafting-panel">
                <div class="crafting-columns">
                    <div class="crafting-column crafting-column--left">
                        <div class="inventory-tabs">
                            <button class="regular-button"
                                style="background-color: rgb(20, 5, 228); color: white; border: 5px solid rgb(1, 0, 88); font-size: large;"
                                @click="transition('crafting', 'returning')">Back</button>
                            <button class="inventory-tab inventory-tab--active">Craftable</button>
                        </div>
                        <div
                            style="padding: 8px 16px; display: flex; gap: 8px; align-items: center; background-color: rgba(0,0,0,0.3);">
                            <span style="font-size: 13px;">Search:</span>
                            <input x-model="craftSearch" type="text" placeholder="Search craftables..."
                                style="font-family: 'Pixelify Sans', sans-serif; font-size: 13px; padding: 5px 8px; min-width: 220px; background-color: rgba(0,0,0,0.5); border: 2px solid #333; color: white;" />
                            <button class="inventory-tab" style="padding: 4px 8px; font-size: 11px;"
                                x-show="craftSearch" @click="craftSearch = ''">Clear</button>
                        </div>
                        <div class="crafting-grid">
                            <template x-for="item in craftables" :key="item.name">
                                <div class="inventory-item crafting-item" draggable="true" :data-craft-name="item.name"
                                    @mouseenter="hoveredCraftItem = item" @mouseleave="hoveredCraftItem = null"
                                    :style="hoveredCraftItem && hoveredCraftItem.name === item.name ? 'border: 2px solid #f87171; background: linear-gradient(180deg, #2a1111 0%, #411414 100%);' : ''"
                                    :data-tooltip="getCraftableTooltipText(item)">
                                    <div class="inventory-item-body"
                                        style="width: 100%; align-items: center; text-align: center;">
                                        <div class="inventory-item-name" x-text="item.name"></div>
                                        <div class="inventory-item-meta" x-html="item.craft.map((ingredient, idx) => {
                                            const requiredUpToThisSlot = item.craft.slice(0, idx + 1).filter(name => name === ingredient).length;
                                            const hasEnough = getOwnedAmount(ingredient) >= requiredUpToThisSlot;
                                                const color = hasEnough ? '#86efac' : '#fca5a5';
                                                const plus = idx < item.craft.length - 1 ? ' + ' : '';
                                                return `<span style='color: ${color};'>${ingredient}</span>${plus}`;
                                            }).join('')"></div>
                                        <div class="inventory-item-meta" x-show="getCraftableDescription(item)"
                                            x-text="getCraftableDescription(item)">
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="crafting-column crafting-column--right">
                        <div class="inventory-tabs">
                            <button @click="activeTab = 'all'" class="inventory-tab"
                                :class="{ 'inventory-tab--active': activeTab === 'all' }">All</button>
                            <button @click="activeTab = 'equipment'" class="inventory-tab"
                                :class="{ 'inventory-tab--active': activeTab === 'equipment' }">Equipment</button>
                            <button @click="activeTab = 'consumables'" class="inventory-tab"
                                :class="{ 'inventory-tab--active': activeTab === 'consumables' }">Consumables</button>
                            <button @click="activeTab = 'battleReady'" class="inventory-tab"
                                :class="{ 'inventory-tab--active': activeTab === 'battleReady' }">Throwables</button>
                            <button @click="activeTab = 'keys'" class="inventory-tab"
                                :class="{ 'inventory-tab--active': activeTab === 'keys' }">Keys</button>
                            <button @click="activeTab = 'miscellaneous'" class="inventory-tab"
                                :class="{ 'inventory-tab--active': activeTab === 'miscellaneous' }">Misc</button>
                        </div>

                        <div
                            style="padding: 10px; display: flex; gap: 10px; align-items: center; background-color: rgba(0,0,0,0.3);">
                            <span style="color: white; font-size: 14px;">Sort by:</span>
                            <button @click="sortBy = 'name'; refreshSynergies()" class="inventory-tab"
                                :class="{ 'inventory-tab--active': sortBy === 'name' }"
                                style="padding: 5px 10px; font-size: 12px;">Name</button>
                            <button @click="sortBy = 'type'; refreshSynergies()" class="inventory-tab"
                                :class="{ 'inventory-tab--active': sortBy === 'type' }"
                                style="padding: 5px 10px; font-size: 12px;">Type</button>
                            <button @click="sortBy = 'level'; refreshSynergies()" class="inventory-tab"
                                :class="{ 'inventory-tab--active': sortBy === 'level' }"
                                style="padding: 5px 10px; font-size: 12px;">Level</button>
                            <button @click="sortOrder = sortOrder === 'asc' ? 'desc' : 'asc'; refreshSynergies()"
                                class="inventory-tab" style="padding: 5px 10px; font-size: 12px;"
                                data-tooltip="Click to reverse">
                                <span x-text="sortOrder === 'asc' ? '‚Üë Ascending' : '‚Üì Descending'"></span>
                            </button>
                        </div>

                        <div
                            style="padding: 10px; display: flex; gap: 10px; align-items: center; background-color: rgba(0,0,0,0.25); border-top: 1px solid rgba(255,255,255,0.1);">
                            <span style="color: white; font-size: 14px;">Search:</span>
                            <input x-model="searchQuery" type="text" placeholder="Search inventory..."
                                style="font-family: 'Pixelify Sans', sans-serif; font-size: 14px; padding: 6px 10px; min-width: 260px; background-color: rgba(0,0,0,0.5); border: 2px solid #333; color: white;" />
                            <button class="inventory-tab" style="padding: 5px 10px; font-size: 12px;"
                                x-show="searchQuery" @click="searchQuery = ''">Clear</button>
                        </div>

                        <div class="crafting-inventory-grid">
                            <template x-for="(item, idx) in (() => {
                let inventory = Alpine.$data(document.getElementById('player')).inventory;
                
                // Filter items
                let filtered = inventory.filter((item, idx) => {
                    let it = assets.items.find(i => i.name === item.name);
                    if (!it) return false;
                    
                    if (activeTab === 'all') return true;
                    
                    const isEquipment = (it.attack !== undefined && it.skills) || (it.defense !== undefined && !it.skills && it.alvlmult !== undefined);
                    const isConsumable = it.name.toLowerCase().includes('potion');
                    const isBattleReady = it.name.toLowerCase().endsWith('bomb') || it.name.toLowerCase().endsWith('flask');
                    const isKey = it.chest !== undefined;
                    const isMiscellaneous = !isEquipment && !isConsumable && !isBattleReady && !isKey;
                    
                    if (activeTab === 'equipment') return isEquipment;
                    if (activeTab === 'consumables') return isConsumable;
                    if (activeTab === 'battleReady') return isBattleReady;
                    if (activeTab === 'keys') return isKey;
                    if (activeTab === 'miscellaneous') return isMiscellaneous;
                    
                    return false;
                });

                const query = searchQuery.toLowerCase().trim();
                if (query) {
                    filtered = filtered.filter(item => {
                        const it = assets.items.find(i => i.name === item.name);
                        const nameMatch = item.name.toLowerCase().includes(query);
                        const descMatch = (it?.description || '').toLowerCase().includes(query);
                        return nameMatch || descMatch;
                    });
                }
                
                filtered.sort((a, b) => {
                    let aItem = assets.items.find(i => i.name === a.name);
                    let bItem = assets.items.find(i => i.name === b.name);
                    
                    let compareVal = 0;
                    
                    if (sortBy === 'name') {
                        compareVal = a.name.localeCompare(b.name);
                    } else if (sortBy === 'type') {
                        // Weapons, Armor, Throwables, Consumables, Misc, Keys
                        const getTypeOrder = (item) => {
                            if (item.attack !== undefined && item.skills) return 0; // weapon
                            if (item.defense !== undefined && !item.skills && item.alvlmult !== undefined) return 1; // armor
                            if (item.damage || item.estatus || (item.buff && item.rounds)) return 2; // throwables
                            if (item.health || item.stamina || item.xp || item.pstatus) return 3; // consumable
                            if (item.chest !== undefined) return 5; // keys
                            return 4; // misc
                        };
                        
                        const aType = getTypeOrder(aItem);
                        const bType = getTypeOrder(bItem);
                        
                        compareVal = aType - bType;
                        if (compareVal === 0) {
                            compareVal = a.name.localeCompare(b.name);
                        }
                    } else if (sortBy === 'level') {
                        const aLevel = a.level ?? 1;
                        const bLevel = b.level ?? 1;
                        compareVal = aLevel - bLevel;
                        if (compareVal === 0) {
                            compareVal = a.name.localeCompare(b.name);
                        }
                    }
                    
                    return sortOrder === 'asc' ? compareVal : -compareVal;
                });
                
                return filtered;
            })()" :key="idx">
                                <div class="inventory-item crafting-inventory-item"
                                    :class="{'inventory-item--no-icon': !(item.sprite)}"
                                    :data-tooltip="getTooltipText(item.name)" draggable="true" x-data="{
                    get desc() {
                        let it = assets.items.find(i => i.name === item.name);
                        const parts = [];
                        if (it.attack !== undefined || it.defense !== undefined || it.maxlvl) {
                            parts.push('Level ' + (item.level ?? 1));
                            if (it.attack !== undefined) {
                                parts.push(`‚öîÔ∏è${Math.floor(it.attack + ((item.level ?? 1 - 1) * it.attackPerLevel))} üçÄ${Math.floor(it.crit * 100)}% ‚öîÔ∏è${it.critdmg}x üéØ${Math.floor(it.accuracy * 100)}%`);
                            } else if (it.defense !== undefined) {
                                parts.push(`üõ°Ô∏è${Math.floor(it.defense + ((item.level ?? 1 - 1) * it.alvlmult))} üí®${Math.floor(it.evasion * 100)}%`);
                            }
                        }
                        if (it.health) parts.push(`üíñ +${Math.round(it.health * 100)}%`);
                        if (it.def) parts.push(`üõ°Ô∏è +${Math.round(it.def * 100)}% ${it.rounds ? `for ${it.rounds} turns` : 'for 1 turn'}`);
                        if (it.stamina) parts.push(`‚ö° +${Math.round(it.stamina * 100)}%`);
                        if (it.buff) parts.push('‚öîÔ∏è +' + Math.round(it.buff * 100) + '% ' + `for ${it.rounds ? it.rounds + ' turns' : '1 turn'}`);
                        if (it.xp) parts.push(`üåü ${it.xp} XP`);
                        if (it.chest !== undefined) parts.push(`Opens ${assets.chests[it.chest].name}`);
                        if (it.damage) parts.push(`üí• ${it.damage}`);
                        if (it.pstatus) parts.push(`Gain ${it.pstatus.join(', ')}`);
                        if (it.estatus) parts.push(`Inflicts ${it.estatus.join(', ')}`);
                        if (parts.length) return parts.join('\n');
                        else return 'Crafting Reagent';
                    }
                }">
                                    <div class="inventory-item-amount inventory-item-amount--inline"
                                        x-show="item.amount > 1 && !(item.sprite)">x<span x-text="item.amount"></span>
                                    </div>
                                    <div class="inventory-item-icon-wrap"
                                        x-show="(() => { let it = assets.items.find(i => i.name === item.name); return it && it.chest !== undefined; })()">
                                        <img class="inventory-item-icon"
                                            :src="`assets/keys/${item.name.replace(/ /g, '')}.gif`" alt="" />
                                    </div>
                                    <div class="inventory-item-body">
                                        <div style="display:flex; align-items:center; gap:8px;">
                                            <div class="inventory-item-name" x-text="item.name">Item</div>
                                        </div>
                                        <div class="inventory-item-meta" x-text="desc"></div>
                                    </div>
                                </div>
                            </template>

                            <div class="inventory-empty" x-show="(() => {
                const inventory = Alpine.$data(document.getElementById('player')).inventory;
                if (inventory.length === 0) return true;
                
                const filteredItems = inventory.filter(item => {
                    let it = assets.items.find(i => i.name === item.name);
                    if (!it) return false;
                    
                    if (activeTab === 'all') return true;
                    
                    const isEquipment = (it.attack !== undefined && it.skills) || (it.defense !== undefined && !it.skills && it.alvlmult !== undefined);
                    const isConsumable = it.name.toLowerCase().includes('potion');
                    const isBattleReady = it.name.toLowerCase().endsWith('bomb') || it.name.toLowerCase().endsWith('flask');
                    const isKey = it.chest !== undefined;
                    const isMiscellaneous = !isEquipment && !isConsumable && !isBattleReady && !isKey;
                    
                    if (activeTab === 'equipment') return isEquipment;
                    if (activeTab === 'consumables') return isConsumable;
                    if (activeTab === 'battleReady') return isBattleReady;
                    if (activeTab === 'keys') return isKey;
                    if (activeTab === 'miscellaneous') return isMiscellaneous;
                    
                    return false;
                });

                const query = searchQuery.toLowerCase().trim();
                const searchedItems = query
                    ? filteredItems.filter(item => {
                        let it = assets.items.find(i => i.name === item.name);
                        const nameMatch = item.name.toLowerCase().includes(query);
                        const descMatch = (it?.description || '').toLowerCase().includes(query);
                        return nameMatch || descMatch;
                    })
                    : filteredItems;
                
                return searchedItems.length === 0;
            })()">
                                No items in this category
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Travel -->
        <div id="travel" class="travel" x-show="screen === 'travel'">
            <div class="travel-panel" id="travel-panel">
                <h1>üìç Travel Across The Hexlands üìç<br></h1>
                <br>
                <div class="travel-grid">
                    <button class="travel-button regular-button travel-button-bg travel-button--warhamshire"
                        :class="{ 'active': location === 'Warhamshire' }"
                        @click="location = 'Warhamshire'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Warhamshire</span>
                        <span class="travel-subtext"
                            x-text="location === 'Warhamshire' ? 'you are here' : '[1-5] Where it all begins...'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--warham-castle"
                        :class="{ 'active': location === 'Warham Castle' }"
                        @click="location = 'Warham Castle'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Warham Castle</span>
                        <span class="travel-subtext"
                            x-text="location === 'Warham Castle' ? 'you are here' : '[6-10] A fortified stronghold.'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--hinterland"
                        :class="{ 'active': location === 'Hinterland' }"
                        @click="location = 'Hinterland'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Hinterland</span>
                        <span class="travel-subtext"
                            x-text="location === 'Hinterland' ? 'you are here' : '[8-14] Shiver through the cold forest.'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--uralan-mountains"
                        :class="{ 'active': location === 'Uralan Mountains' }"
                        @click="location = 'Uralan Mountains'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Uralan Mountains</span>
                        <span class="travel-subtext"
                            x-text="location === 'Uralan Mountains' ? 'you are here' : '[12-18] Scale the high peaks and low valleys.'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--vulpeston"
                        :class="{ 'active': location === 'Vulpeston' }"
                        @click="location = 'Vulpeston'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Vulpeston</span>
                        <span class="travel-subtext"
                            x-text="location === 'Vulpeston' ? 'you are here' : '[16-22] Infiltrate the sly and cunning theives.'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--vulpes-tower"
                        :class="{ 'active': location === 'Vulpes Tower' }"
                        @click="location = 'Vulpes Tower'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Vulpes Tower</span>
                        <span class="travel-subtext"
                            x-text="location === 'Vulpes Tower' ? 'you are here' : '[21-29] An ancient spire full of luxury goods.'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--vexadel"
                        :class="{ 'active': location === 'Vexadel' }"
                        @click="location = 'Vexadel'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Vexadel</span>
                        <span class="travel-subtext"
                            x-text="location === 'Vexadel' ? 'you are here' : '[30-35] It smells terrible.'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--vexadel-gaillard"
                        :class="{ 'active': location === 'Vexadel Gaillard' }"
                        @click="location = 'Vexadel Gaillard'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Vexadel Gaillard</span>
                        <span class="travel-subtext"
                            x-text="location === 'Vexadel Gaillard' ? 'you are here' : '[35-40] Who knew the smell could get worse.'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--sanguisuge"
                        :class="{ 'active': location === 'Sanguisuge' }"
                        @click="location = 'Sanguisuge'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Sanguisuge</span>
                        <span class="travel-subtext"
                            x-text="location === 'Sanguisuge' ? 'you are here' : '[41-45] A blood-soaked realm.'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--sangston-mansion"
                        :class="{ 'active': location === 'Sangston Mansion' }"
                        @click="location = 'Sangston Mansion'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Sangston Mansion</span>
                        <span class="travel-subtext"
                            x-text="location === 'Sangston Mansion' ? 'you are here' : '[46-50] The vampire estate.'"></span>
                    </button>

                    <button class="travel-button regular-button travel-button-bg travel-button--eternal-damnation"
                        :class="{ 'active': location === 'Eternal Damnation' }"
                        @click="location = 'Eternal Damnation'; transition('travel','returning'); savePlayer();">
                        <span class="travel-name">Eternal Damnation</span>
                        <span class="travel-subtext"
                            x-text="location === 'Eternal Damnation' ? 'you are here' : '[50+] Fun for the whole family.'"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Encounter -->
        <div id="encounter" class="encounter" x-show="screen === 'encounter'" x-data="{
                log: [],
                health: 1,
                maxHealth: 1,
                defense: 0,
                attack: 0,
                crit: 0,
                accuracy: 0,
                estatus: [],
                battle: true,

                get playerName() {
                    return Alpine.$data(document.getElementById('background-image')).name || 'Player';
                },

                get enemyName() {
                    return Alpine.$data(document.getElementById('background-image')).enemy.name || 'Enemy';
                },

                get formattedLog() {
                    return this.log
                        .map(line =>
                            line
                                .replaceAll(this.playerName, `<span style='color:rgb(0, 255, 13);' data-tooltip='You!'>${this.playerName}</span>`)
                                .replaceAll(this.enemyName, `<span style='color:red;' data-tooltip='Level ${Alpine.$data(document.getElementById('background-image')).enemyLevel}\n‚öîÔ∏è ${this.attack}\nüõ°Ô∏è ${this.defense}\nüéØ ${Math.floor(this.accuracy * 100)}%\nüçÄ ${Math.floor(this.crit * 100)}%'>${this.enemyName}</span>`)
                                .replaceAll(`CRIT`, `<span style='color:red;'>CRIT</span>`)
                                .replaceAll(`MISSED`, `<span style='color:grey;'>MISSED</span>`)
                                .replaceAll(`MISS`, `<span style='color:grey;'>MISS</span>`)
                        )
                        .join('<br>');
                }
            }">
            <div class="enemy" id="enemy">
                <div class="enemy-level" x-text="`Level ${enemyLevel}`">?</div>
                <div style="margin-top: 40px;">
                    <div class="enemy-name" x-text="enemy.name">???</div>
                    <div class="estatus-effects">
                        <span x-show="estatus.some(status => status.id == 'ü©∏')"
                            :data-tooltip="`ü©∏ ${estatus.find(s => s.id == 'ü©∏').name} - ${estatus.find(s => s.id == 'ü©∏').rounds} round${estatus.find(s => s.id == 'ü©∏').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'ü©∏').description}\n\n${estatus.find(s => s.id == 'ü©∏').damage} * ${estatus.find(s => s.id == 'ü©∏').baseDam} = ${Math.floor(estatus.find(s => s.id == 'ü©∏').damage * estatus.find(s => s.id == 'ü©∏').baseDam)}`">ü©∏</span>
                        <span x-show="estatus.some(status => status.id == 'üëÅÔ∏è')"
                            :data-tooltip="`üëÅÔ∏è ${estatus.find(s => s.id == 'üëÅÔ∏è').name} - ${estatus.find(s => s.id == 'üëÅÔ∏è').rounds} round${estatus.find(s => s.id == 'üëÅÔ∏è').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üëÅÔ∏è').description}`">üëÅÔ∏è</span>
                        <span x-show="estatus.some(status => status.id == 'üî•')"
                            :data-tooltip="`üî• ${estatus.find(s => s.id == 'üî•').name} - ${estatus.find(s => s.id == 'üî•').rounds} round${estatus.find(s => s.id == 'üî•').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üî•').description}\n\n${estatus.find(s => s.id == 'üî•').damage} * ${estatus.find(s => s.id == 'üî•').baseDam} = ${Math.floor(estatus.find(s => s.id == 'üî•').damage * estatus.find(s => s.id == 'üî•').baseDam)}`">üî•</span>
                        <span x-show="estatus.some(status => status.id == 'üñ§')"
                            :data-tooltip="`üñ§ ${estatus.find(s => s.id == 'üñ§').name} - ${estatus.find(s => s.id == 'üñ§').rounds} round${estatus.find(s => s.id == 'üñ§').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üñ§').description}\n\n${estatus.find(s => s.id == 'üñ§').damage} * ${estatus.find(s => s.id == 'üñ§').baseDam} = ${Math.floor(estatus.find(s => s.id == 'üñ§').damage * estatus.find(s => s.id == 'üñ§').baseDam)}`">üñ§</span>
                        <span x-show="estatus.some(status => status.id == 'üèÖ')"
                            :data-tooltip="`üèÖ ${estatus.find(s => s.id == 'üèÖ').name} - ${estatus.find(s => s.id == 'üèÖ').rounds} round${estatus.find(s => s.id == 'üèÖ').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üèÖ').description}`">üèÖ</span>
                        <span x-show="estatus.some(status => status.id == 'üí®')"
                            :data-tooltip="`üí® ${estatus.find(s => s.id == 'üí®').name} - ${estatus.find(s => s.id == 'üí®').rounds} round${estatus.find(s => s.id == 'üí®').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üí®').description}`">üí®</span>
                        <span x-show="estatus.some(status => status.id == 'üíÄ')"
                            :data-tooltip="`üíÄ ${estatus.find(s => s.id == 'üíÄ').name} - ${estatus.find(s => s.id == 'üíÄ').rounds} round${estatus.find(s => s.id == 'üíÄ').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üíÄ').description}\n\n${estatus.find(s => s.id == 'üíÄ').damage} * ${estatus.find(s => s.id == 'üíÄ').baseDam} = ${Math.floor(estatus.find(s => s.id == 'üíÄ').damage * estatus.find(s => s.id == 'üíÄ').baseDam)}`">üíÄ</span>
                        <span x-show="estatus.some(status => status.id == 'üéØ')"
                            :data-tooltip="`üéØ ${estatus.find(s => s.id == 'üéØ').name} - ${estatus.find(s => s.id == 'üéØ').rounds} round${estatus.find(s => s.id == 'üéØ').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üéØ').description}`">üéØ</span>
                        <span x-show="estatus.some(status => status.id == 'üõ°Ô∏è')"
                            :data-tooltip="`üõ°Ô∏è ${estatus.find(s => s.id == 'üõ°Ô∏è').name} - ${estatus.find(s => s.id == 'üõ°Ô∏è').rounds} round${estatus.find(s => s.id == 'üõ°Ô∏è').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üõ°Ô∏è').description}`">üõ°Ô∏è</span>
                        <span x-show="estatus.some(status => status.id == 'üçÄ')"
                            :data-tooltip="`üçÄ ${estatus.find(s => s.id == 'üçÄ').name} - ${estatus.find(s => s.id == 'üçÄ').rounds} round${estatus.find(s => s.id == 'üçÄ').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üçÄ').description}`">üçÄ</span>
                        <span x-show="estatus.some(status => status.id == 'üíó')"
                            :data-tooltip="`üíó ${estatus.find(s => s.id == 'üíó').name} - ${estatus.find(s => s.id == 'üíó').rounds} round${estatus.find(s => s.id == 'üíó').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üíó').description}\n\n${maxHealth} * ${estatus.find(s => s.id == 'üíó').maxHP} = ${Math.floor(estatus.find(s => s.id == 'üíó').maxHP * maxHealth)}`">üíó</span>
                        <span x-show="estatus.some(status => status.id == 'üí™')"
                            :data-tooltip="`üí™ ${estatus.find(s => s.id == 'üí™').name} - ${estatus.find(s => s.id == 'üí™').rounds} round${estatus.find(s => s.id == 'üí™').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üí™').description}`">üí™</span>
                        <span x-show="estatus.some(status => status.id == 'üåÄ')"
                            :data-tooltip="`üåÄ ${estatus.find(s => s.id == 'üåÄ').name} - ${estatus.find(s => s.id == 'üåÄ').rounds} round${estatus.find(s => s.id == 'üåÄ').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üåÄ').description}`">üåÄ</span>
                        <span x-show="estatus.some(status => status.id == 'ü•Ä')"
                            :data-tooltip="`ü•Ä ${estatus.find(s => s.id == 'ü•Ä').name} - ${estatus.find(s => s.id == 'ü•Ä').rounds} round${estatus.find(s => s.id == 'ü•Ä').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'ü•Ä').description}`">ü•Ä</span>
                        <span x-show="estatus.some(status => status.id == 'üí¢')"
                            :data-tooltip="`üí¢ ${estatus.find(s => s.id == 'üí¢').name} - ${estatus.find(s => s.id == 'üí¢').rounds} round${estatus.find(s => s.id == 'üí¢').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üí¢').description}`">üí¢</span>
                        <span x-show="estatus.some(status => status.id == 'üí´')"
                            :data-tooltip="`üí´ ${estatus.find(s => s.id == 'üí´').name} - ${estatus.find(s => s.id == 'üí´').rounds} round${estatus.find(s => s.id == 'üí´').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üí´').description}`">üí´</span>
                        <span x-show="estatus.some(status => status.id == '‚ú®')"
                            :data-tooltip="`‚ú® ${estatus.find(s => s.id == '‚ú®').name} - ${estatus.find(s => s.id == '‚ú®').rounds} round${estatus.find(s => s.id == '‚ú®').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == '‚ú®').description}`">‚ú®</span>
                        <span x-show="estatus.some(status => status.id == 'üåë')"
                            :data-tooltip="`üåë ${estatus.find(s => s.id == 'üåë').name} - ${estatus.find(s => s.id == 'üåë').rounds} round${estatus.find(s => s.id == 'üåë').rounds > 1 ? 's' : ''} remaining\n\n${estatus.find(s => s.id == 'üåë').description}`">üåë</span>
                        <span x-show="health <= 0" :data-tooltip="`This ${enemyName} is dead.`">‚ò†Ô∏è</span>
                    </div>
                </div>
                <div style="margin-top: 70px;">
                    <img class="enemy-heart" :src="
                        enemy.name == 'Cursed Goblin' ? 'assets/enemy_hearts/Cursed.png'
                        : enemy.name == 'Attack Slime' ? 'assets/enemy_hearts/AttackSlime.png'
                        : enemy.name == 'Defense Slime' ? 'assets/enemy_hearts/DefenseSlime.png'
                        : enemy.name == 'Health Slime' ? 'assets/enemy_hearts/HealthSlime.png'
                        : enemy.name == 'Stamina Slime' ? 'assets/enemy_hearts/StaminaSlime.png'
                        : enemy.name == 'Demon' || enemy.name == 'Witch' ? 'assets/enemy_hearts/Demonic.png'
                        : enemy.name == 'Cyclops Overlord' ? 'assets/enemy_hearts/Cyclops.png'
                        : enemy.name == 'Fox King' ? 'assets/enemy_hearts/FoxKing.png'
                        : enemy.name == 'Goblin King' ? 'assets/enemy_hearts/GoblinKing.png'
                        : enemy.name == 'Demon Queen' ? 'assets/enemy_hearts/DemonQueen.png'
                        : 'assets/enemy_hearts/Basic.png'
                        " style="width: 80px; top: 70%; left: 1%; z-index: 3;">
                    <div class="enemy-health-bar-stats" x-text="`${health}/${maxHealth}`">0/0</div>
                    <div class="enemy-health-bar" id="enemy-health"></div>
                    <div class="enemy-health-bar-background"></div>
                </div>
                <img class="enemy-thumbnail" :src="enemy.sprite">
            </div>
            <div class="battle-log" x-html="formattedLog" x-init=" $watch('log', () => {
                    $nextTick(() => {
                        $el.scrollTop = $el.scrollHeight
                    })
                })">
            </div>
            <div class="battle-station" id="battle-station"
                x-data="{ round: 1, turn: true, get weapon() { return Alpine.$data(document.getElementById('player')).weaponry.weapon } }">
                <div class="battle-buttons" x-show="battle">
                    <div class="battle-actions" style="display: flex; gap: 20px;">
                        <button class="battle-base-attack"
                            :style="`background-color: ${turn ? 'rgb(253, 113, 113)' : 'rgb(55, 55, 55)'}; color: black; border: 5px solid rgb(245, 17, 17); font-size: 40px; font-family: 'Pixelify Sans', sans-serif; cursor: ${turn ? 'pointer' : 'not-allowed'};`"
                            x-text="weapon.skills[0].name" :disabled="!turn" @click="skill(0)"
                            :data-tooltip="`${weapon.skills[0].description ? `${weapon.skills[0].description}\n` : ''}${weapon.skills[0].cost ? `‚ö°${weapon.skills[0].cost}\n` : ''}‚öîÔ∏è x${weapon.skills[0].attack ? (weapon.skills[0].damage || 1) : 0}\n${weapon.skills[0].times ? `üîÑÔ∏è${weapon.skills[0].times}x\n` : ''}${weapon.skills[0].flatHealth ? `‚ù§Ô∏è ${weapon.skills[0].flatHealth}\n` : ''}${weapon.skills[0].health ? `üíñ ${Math.floor(weapon.skills[0].health * 100)}%\n` : ''}${weapon.skills[0].lifesteal ? `üíû ${Math.floor(weapon.skills[0].lifesteal * 100)}%\n` : ''}${weapon.skills[0].pstatus ? `Gains ${weapon.skills[0].pstatus.join('')}\n` : ''}${weapon.skills[0].estatus ? 'Inflicts ' + weapon.skills[0].estatus.join('') : ''}`">Attack</button>
                        <button class="battle-pass"
                            :style="`background-color: ${turn ? 'rgb(42, 143, 201)' : 'rgb(55, 55, 55)'}; border: 5px solid rgb(6, 0, 88); font-size: 40px;font-family: 'Pixelify Sans', sans-serif; cursor: ${turn ? 'pointer' : 'not-allowed'};`"
                            :data-tooltip="`Skip your turn but gain‚ö°${Math.round(Alpine.$data(player).maxStamina * 0.1)}`"
                            :disabled="!turn" @click="skill(-1)">Pass</button>
                        <button class="battle-item"
                            :style="`background-color: ${turn ? 'rgb(138, 233, 138)' : 'rgb(55, 55, 55)'}; color: black; border: 5px solid rgb(0, 97, 21); font-size: 40px; font-size: 40px; font-family: 'Pixelify Sans', sans-serif; cursor: ${turn ? 'pointer' : 'not-allowed'};`"
                            :disabled="!turn" @click="skill(-2)">Item</button>
                        <button class="battle-flee"
                            :style="`background-color: ${turn ? 'red' : 'background-color: rgb(55, 55, 55)'}; color: white; border: 5px solid rgb(88, 0, 0); font-size: 40px; font-size: 40px;font-family: 'Pixelify Sans', sans-serif; cursor: ${turn ? 'pointer' : 'not-allowed'};`"
                            :disabled="!turn" @click="skill(-3)">Flee</button>
                    </div>

                    <div class="battle-skills"
                        style="display: flex; flex-direction: row; gap: 20px; justify-content: center; align-items: flex-start;">

                        <!-- Skill 1 Group -->
                        <div x-show="weapon.skills[1]">
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                                <button class="battle-skill1" id="battle-skill1" x-text="weapon.skills[1].name"
                                    :disabled="Alpine.$data(player).stamina < weapon.skills[1].cost || !turn"
                                    :style="`${ (Alpine.$data(player).stamina < weapon.skills[1].cost || !turn) ? 'background-color: rgb(55, 55, 55)' : 'background-color: rgb(20, 5, 228)' }; color: white; border: 5px solid rgb(1, 0, 88); font-size: 40px; font-family: 'Pixelify Sans', sans-serif; cursor: ${ (Alpine.$data(player).stamina < weapon.skills[1].cost || !turn) ? 'not-allowed' : 'pointer' };`"
                                    :data-tooltip="`${weapon.skills[1].description ? `${weapon.skills[1].description}\n` : ''}${weapon.skills[1].cost ? `‚ö°${weapon.skills[1].cost}\n` : ''}‚öîÔ∏è x${weapon.skills[1].attack ? (weapon.skills[1].damage || 1) : 0}\n${weapon.skills[1].times ? `üîÑÔ∏è${weapon.skills[1].times}x\n` : ''}${weapon.skills[1].flatHealth ? `‚ù§Ô∏è ${weapon.skills[1].flatHealth}\n` : ''}${weapon.skills[1].health ? `üíñ ${Math.floor(weapon.skills[1].health * 100)}%\n` : ''}${weapon.skills[1].lifesteal ? `üíû ${Math.floor(weapon.skills[1].lifesteal * 100)}%\n` : ''}${weapon.skills[1].pstatus ? `Gains ${weapon.skills[1].pstatus.join('')}\n` : ''}${weapon.skills[1].estatus ? 'Inflicts ' + weapon.skills[1].estatus.join('') : ''}`"
                                    @click="skill(1)">
                                    ?
                                </button>
                                <span class="battle-skill1-cost" id="battle-skill1-cost"
                                    style="font-family: 'Pixel-Font', sans-serif; font-size: 24px;"
                                    x-text="`‚ö°${weapon.skills[1].cost}`">?</span>
                            </div>
                        </div>

                        <!-- Skill 2 Group -->
                        <div x-show="weapon.skills[2]">
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                                <button class="battle-skill2" id="battle-skill2"
                                    :style="`${ (Alpine.$data(player).stamina < weapon.skills[2].cost || !turn) ? 'background-color: rgb(55, 55, 55)' : 'background-color: rgb(20, 5, 228)' }; color: white; border: 5px solid rgb(1, 0, 88); font-size: 40px; font-family: 'Pixelify Sans', sans-serif; cursor: ${ (Alpine.$data(player).stamina < weapon.skills[2].cost || !turn) ? 'not-allowed' : 'pointer' };`"
                                    :disabled="Alpine.$data(player).stamina < weapon.skills[2].cost || !turn"
                                    :data-tooltip="`${weapon.skills[2].description ? `${weapon.skills[2].description}\n` : ''}${weapon.skills[2].cost ? `‚ö°${weapon.skills[2].cost}\n` : ''}‚öîÔ∏è x${weapon.skills[2].attack ? (weapon.skills[2].damage || 1) : 0}\n${weapon.skills[2].times ? `üîÑÔ∏è${weapon.skills[2].times}x\n` : ''}${weapon.skills[2].flatHealth ? `‚ù§Ô∏è ${weapon.skills[2].flatHealth}\n` : ''}${weapon.skills[2].health ? `üíñ ${Math.floor(weapon.skills[2].health * 100)}%\n` : ''}${weapon.skills[2].lifesteal ? `üíû ${Math.floor(weapon.skills[2].lifesteal * 100)}%\n` : ''}${weapon.skills[2].pstatus ? `Gains ${weapon.skills[2].pstatus.join('')}\n` : ''}${weapon.skills[2].estatus ? 'Inflicts ' + weapon.skills[2].estatus.join('') : ''}`"
                                    x-text="weapon.skills[2].name" @click="skill(2)">
                                    ?
                                </button>
                                <span class="battle-skill2-cost" id="battle-skill2-cost"
                                    style="font-family: 'Pixel-Font', sans-serif; font-size: 24px;"
                                    x-text="`‚ö°${weapon.skills[2].cost}`">?</span>
                            </div>
                        </div>


                        <!-- Skill 3 Group -->
                        <div x-show="weapon.skills[3]">
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                                <button class="battle-skill3" id="battle-skill3"
                                    :style="`${ (Alpine.$data(player).stamina < weapon.skills[3].cost || !turn) ? 'background-color: rgb(55, 55, 55)' : 'background-color: rgb(20, 5, 228)' }; color: white; border: 5px solid rgb(1, 0, 88); font-size: 40px; font-family: 'Pixelify Sans', sans-serif; cursor: ${ (Alpine.$data(player).stamina < weapon.skills[3].cost || !turn) ? 'not-allowed' : 'pointer' };`"
                                    :disabled="Alpine.$data(player).stamina < weapon.skills[3].cost || !turn"
                                    :data-tooltip="`${weapon.skills[3].description ? `${weapon.skills[3].description}\n` : ''}${weapon.skills[3].cost ? `‚ö°${weapon.skills[3].cost}\n` : ''}‚öîÔ∏è x${weapon.skills[3].attack ? (weapon.skills[3].damage || 1) : 0}\n${weapon.skills[3].times ? `üîÑÔ∏è${weapon.skills[3].times}x\n` : ''}${weapon.skills[3].flatHealth ? `‚ù§Ô∏è ${weapon.skills[3].flatHealth}\n` : ''}${weapon.skills[3].health ? `üíñ ${Math.floor(weapon.skills[3].health * 100)}%\n` : ''}${weapon.skills[3].lifesteal ? `üíû ${Math.floor(weapon.skills[3].lifesteal * 100)}%\n` : ''}${weapon.skills[3].pstatus ? `Gains ${weapon.skills[3].pstatus.join('')}\n` : ''}${weapon.skills[3].estatus ? 'Inflicts ' + weapon.skills[3].estatus.join('') : ''}`"
                                    x-text="weapon.skills[3].name" @click="skill(3)">
                                </button>
                                <span class="battle-skill3-cost" id="battle-skill3-cost"
                                    style="font-family: 'Pixel-Font', sans-serif; font-size: 24px;"
                                    x-text="`‚ö°${weapon.skills[3].cost}`">?</span>
                            </div>
                        </div>

                    </div>

                </div>
                <div class="battle-buttons" x-show="!battle">
                    <button class="battle-item"
                        style="background-color: rgb(42, 201, 42); border: 5px solid rgb(0, 88, 0); font-size: 40px; font-size: 40px; font-family: 'Pixelify Sans', sans-serif; cursor: pointer;"
                        @click="victory()">Continue</button>
                </div>
                <div class="round-info"
                    x-text="health > 0 && Alpine.$data(document.getElementById('player')).health > 0 ? `Round ${round}\n\n${turn ? 'Your' : enemyName + `'s`} Turn` : health <= 0 ? `You Won` : `You Died`"
                    style="white-space: pre-line; text-align: center;">Round 1\n\nYour Turn</div>
            </div>
        </div>

        <!-- Debug -->
        <div class="debug" x-data="{ open: false }" :class="{ 'open': open }" id="debug-panel">
            <h1>‚öô Debug Panel</h1>
            <br>
            <div class="debug-grid">
                <button @click="savePlayer()"
                    style="font-family: 'Pixel-Font', sans-serif; background-color: transparent; border: 2px solid white; cursor: pointer; color: white;">Save
                    Game</button>
                <input placeholder="Set Level"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).level = $event.target.value; setPlayer(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Set Health"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).health = $event.target.value; updateBars(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Set Max Health"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).maxHealth = $event.target.value; updateBars(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Set Stamina"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).stamina = $event.target.value; updateBars(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Set Max Stamina"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).maxStamina = $event.target.value; updateBars(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Set XP"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).experience = $event.target.value; updateBars(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Set Weapon"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).weaponry = {weapon: assets.items.find(w => w.name == $event.target.value), level: 1}; setPlayer(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Set Weapon Level"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).weaponry.level = $event.target.value; setPlayer(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Set Armor"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).armory = {armor: assets.items.find(a => a.name == $event.target.value), level: 1}; setPlayer(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Set Armor Level"
                    @keyup.enter="Alpine.$data(document.getElementById('player')).armory.level = $event.target.value; setPlayer(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Get Item"
                    @keyup.enter="addToInventory(assets.items.find(i => i.name == $event.target.value), 5); setPlayer(); $event.target.value = '';" />

                <input placeholder="Enemy Level"
                    @keyup.enter="enemyLevel = Number($event.target.value); setPlayer(); $event.target.value = ''; $event.target.blur()" />

                <input placeholder="Encounter Enemy"
                    @keyup.enter="transition('debug', 'encounter'); startBattle(assets.enemies.find(e => e.name == $event.target.value)); $event.target.value = ''; $event.target.blur()" />
            </div>
            <br>
            <h2>Press ` to close</h2>
        </div>
    </div>
    </div>
</body>

</html>